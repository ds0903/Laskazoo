{% extends 'zoosvit/core/base.html' %}
{% load static %}

{% block title %}Вхід{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'zoosvit/css/auth.css' %}">
{% endblock %}

{% block content %}
<div class="auth-page-container">
  <div class="auth-page-content">
    <div class="auth-tabs">
      <button class="auth-tab active" data-tab="login">Вхід</button>
    </div>
    <div class="auth-form" id="login-form" style="display: block;">
      <form id="login-form-ajax" method="post" action="{% url 'users:login' %}">
        {% csrf_token %}

        {% if error %}
          <div class="error-message">{{ error }}</div>
        {% endif %}

        {% if login_form.non_field_errors %}
          <div class="error-message">
            {% for err in login_form.non_field_errors %}
              {{ err }}
            {% endfor %}
          </div>
        {% endif %}

        <div class="form-group">
          <label for="id_email">Email:</label>
          {{ login_form.email }}
          {% for err in login_form.email.errors %}
            <div class="error-message">{{ err }}</div>
          {% endfor %}
        </div>

        <div class="form-group">
          <label for="id_password">Пароль:</label>
          {{ login_form.password }}
          {% for err in login_form.password.errors %}
            <div class="error-message">{{ err }}</div>
          {% endfor %}
        </div>

        <button type="submit">Увійти</button>
      </form>
    </div>
  </div>
</div>

<script>
(function() {
  console.log('Auth page script loaded');
  
  function initTabSwitching() {
    const tabs = document.querySelectorAll('.auth-tab');
    const loginForm = document.getElementById('login-form');
    const registerForm = document.getElementById('register-form');
    
    console.log('Tabs found:', tabs.length);
    console.log('Login form:', loginForm);
    console.log('Register form:', registerForm);
    
    if (!tabs.length || !loginForm || !registerForm) {
      console.error('Elements not found!');
      return;
    }

    tabs.forEach(tab => {
      tab.addEventListener('click', function(e) {
        e.preventDefault();
        const targetTab = this.getAttribute('data-tab');
        console.log('Tab clicked:', targetTab);
        
        // Оновлюємо активний таб
        tabs.forEach(t => t.classList.remove('active'));
        this.classList.add('active');

        // Показуємо потрібну форму
        if (targetTab === 'login') {
          loginForm.style.display = 'block';
          registerForm.style.display = 'none';
        } else {
          loginForm.style.display = 'none';
          registerForm.style.display = 'block';
        }
      });
    });
  }
  
  // Запускаємо ініціалізацію після завантаження DOM
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initTabSwitching);
  } else {
    initTabSwitching();
  }
})();
</script>
{% endblock %}
