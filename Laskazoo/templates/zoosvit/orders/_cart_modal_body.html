{% load static %}

<div class="cm-header">
  <h3>Кошик</h3>
  <button class="cm-close" aria-label="Закрити">×</button>
</div>

{# 1) Авторизований користувач з позиціями #}
{% if order and order.items.all %}
  <ul class="cm-items">
    {% for item in order.items.all %}
      <li class="cm-row" data-item="{{ item.id }}">
        <div class="cm-thumb">
          {% if item.variant and item.variant.image %}
            <img src="{{ item.variant.image.url }}" alt="{{ item.product.name }}">
          {% elif item.product.image %}
            <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}">
          {% else %}
            <img src="{% static 'zoosvit/img/placeholder.jpg' %}" alt="{{ item.product.name }}">
          {% endif %}
        </div>

        <div class="cm-info">
          <div class="cm-title">{{ item.product.name }}</div>
          {% if item.variant %}
            <div class="cm-meta">
              {% if item.variant.sku %}SKU: {{ item.variant.sku }}{% endif %}
              {% if item.variant.weight %} · {{ item.variant.weight }} г{% endif %}
              {% if item.variant.size %} · Розмір {{ item.variant.size }}{% endif %}
            </div>
          {% endif %}
        </div>

        <div class="cm-qty">
          <a href="{% url 'orders:item_dec' item.id %}?ajax=1" class="cm-btn js-cart">−</a>
          <input
            type="number"
            class="cm-qty-input"
            value="{{ item.quantity }}"
            min="1"
            {% if item.variant and item.variant.warehouse_quantity %}max="{{ item.variant.warehouse_quantity }}"{% endif %}
            data-item="{{ item.id }}"
            inputmode="numeric"
          >
          <a href="{% url 'orders:item_inc' item.id %}?ajax=1" class="cm-btn js-cart">+</a>
        </div>

        <div class="cm-sum"><b>{{ item.line_total|floatformat:2 }} грн</b></div>
        <a href="{% url 'orders:item_remove' item.id %}?ajax=1" class="cm-remove js-cart" aria-label="Видалити">×</a>
      </li>
    {% endfor %}
  </ul>

  <div class="cm-footer">
    <div class="cm-total">Всього: <b>{{ total }} грн</b></div>
    <div class="cm-actions">
      <a href="{% url 'orders:checkout' %}" class="btn-green cm-checkout">Оформити замовлення</a>
      <a href="{% url 'orders:clear' %}?ajax=1" class="btn-outline js-cart">Очистити кошик</a>
    </div>
  </div>

{# 2) Гість: позиції з сесії (з фото + керування кількістю) #}
{% elif sitems %}
  <ul class="cm-items">
    {% for it in sitems %}
      <li class="cm-row">
        <div class="cm-thumb">
          {% if it.thumb %}<img src="{{ it.thumb }}" alt="{{ it.name }}">
          {% else %}<img src="{% static 'zoosvit/img/placeholder.jpg' %}" alt="{{ it.name }}">{% endif %}
        </div>

        <div class="cm-info">
          <div class="cm-title">{{ it.name }}</div>
          <div class="cm-meta">
            {% if it.sku %}SKU: {{ it.sku }}{% endif %}
            {% if it.weight %} · {{ it.weight }} г{% endif %}
            {% if it.size %} · Розмір {{ it.size }}{% endif %}
          </div>
        </div>

        <div class="cm-qty">
          <a href="{% url 'orders:item_dec' it.sid %}?ajax=1&guest=1" class="cm-btn js-cart">−</a>
          <input
            type="number"
            class="cm-qty-input"
            value="{{ it.qty }}"
            min="1"
            data-item="{{ it.sid }}"
            inputmode="numeric">
          <a href="{% url 'orders:item_inc' it.sid %}?ajax=1&guest=1" class="cm-btn js-cart">+</a>
        </div>

        <div class="cm-sum"><b>{{ it.line|floatformat:2 }} грн</b></div>
        <a href="{% url 'orders:item_remove' it.sid %}?ajax=1&guest=1" class="cm-remove js-cart" aria-label="Видалити">×</a>
      </li>
    {% endfor %}
  </ul>

  <div class="cm-footer">
  <div class="cm-total">Всього: <b>{{ total|floatformat:2 }} грн</b></div>
  <div class="cm-actions">
    <a href="{% url 'users:register' %}?next={{ request.get_full_path|urlencode }}" class="btn-outline">
      Зареєструйтесь, щоб оформити
    </a>
    <a href="{% url 'orders:clear' %}?ajax=1&guest=1" class="btn-outline js-cart">
      Очистити кошик
    </a>
    <a href="{% url 'users:login' %}?next={{ request.get_full_path|urlencode }}" class="btn-green">
      Увійти
    </a>
  </div>
</div>


<style>.cm-actions{
  display:flex;
  align-items:center;
  justify-content:flex-end; /* вирівняти вправо */
  gap:14px;                 /* відступ між кнопками */
  flex-wrap:wrap;
}

.cm-actions .btn-green,
.cm-actions .btn-outline{
  height:40px;
  padding:0 16px;
  border-radius:10px;
  font-weight:600;
  text-decoration:none;
  display:inline-flex;
  align-items:center;
  justify-content:center;
}

.btn-green{
  background:#28a745;
  color:#fff !important;
  border:none;
}

.btn-outline{
  border:1px solid #ccc;
  color:#333 !important;
  background:#fff;
}
</style>

{# 3) Порожній кошик #}
{% else %}
  <div class="cm-empty">
    <p>Ваш кошик порожній.</p>
  </div>
{% endif %}
