<style>
.cart-item.out-of-stock {
  opacity: 0.6;
  background: #f5f5f5;
}
.cart-item.out-of-stock td {
  color: #999;
  text-decoration: line-through;
}
.out-of-stock-label {
  color: #d9534f;
  font-weight: bold;
  font-size: 0.9em;
}
</style>

<h1>Кошик</h1>

{% if messages %}
  <ul class="messages">
    {% for m in messages %}<li>{{ m }}</li>{% endfor %}
  </ul>
{% endif %}

{% if order and order.items.count %}
  <table>
    <thead>
      <tr><th>Товар</th><th>Ціна</th><th>К-сть</th><th>Сума</th><th></th></tr>
    </thead>
    <tbody>
      {% for item in order.items.all %}
        {% with is_inactive=False %}
          {% if item.variant %}
            {% if not item.variant.is_active or item.variant.warehouse_quantity == 0 %}
              {% with is_inactive=True %}{% endwith %}
            {% endif %}
          {% elif not item.product.is_active or item.product.warehouse_quantity == 0 %}
            {% with is_inactive=True %}{% endwith %}
          {% endif %}
        {% endwith %}
        
        <tr class="cart-item {% if item.variant and not item.variant.is_active or item.variant and item.variant.warehouse_quantity == 0 or not item.variant and not item.product.is_active or not item.variant and item.product.warehouse_quantity == 0 %}out-of-stock{% endif %}">
          <td>
            {{ item.product.name }}
            {% if item.variant %}<br><small>SKU: {{ item.variant.sku }}</small>{% endif %}
            {% if item.variant and not item.variant.is_active or item.variant and item.variant.warehouse_quantity == 0 or not item.variant and not item.product.is_active or not item.variant and item.product.warehouse_quantity == 0 %}
              <br><span class="out-of-stock-label">Немає в наявності</span>
            {% endif %}
          </td>
          <td>{{ item.retail_price }} грн</td>
          <td>{{ item.quantity }}</td>
          <td>{% widthratio item.quantity 1 item.retail_price %} грн</td>
          <td><a href="{% url 'orders:item_remove' item.id %}">Видалити</a></td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <p><b>Всього:</b> {{ total }} грн</p>
  <p>
    <a href="{% url 'orders:checkout' %}">Оформити замовлення</a>
    {% comment %} Переконайся, що шлях orders:clear існує у urls.py {% endcomment %}
    <a href="{% url 'orders:clear' %}">Очистити кошик</a>
  </p>
{% else %}
  <p>Кошик порожній</p>
{% endif %}

