{# Zoosvit_shop/Zoosvit/templates/zoosvit/favourites/list.html #}
{% extends 'zoosvit/core/base.html' %}
{% load static %}

{% block title %}Обране{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'zoosvit/css/favourites/ favourites_list.css' %}">
  <link rel="stylesheet" href="{% static 'zoosvit/css/users/profile.css' %}">
  <link rel="stylesheet" href="{% static 'zoosvit/css/styles.css' %}">
{% endblock %}

{% block content %}
<div class="profile-wrapper">

  <!-- Сайдбар -->
  <aside class="profile-sidebar">
    <ul class="profile-nav">
      {% if user.is_authenticated %}
        <li><a href="{% url 'users:profile' %}">Особисті дані</a></li>
        <li><a href="{% url 'orders:list' %}">Замовлення</a></li>
      {% endif %}

      {# Обране – завжди #}
      <li class="active"><a href="{% url 'favourites:list' %}">Обране</a></li>
    </ul>
  </aside>

  <!-- Основний контент -->
  <section class="profile-main favourites-page">
    <h1 class="profile-title">Моє обране</h1>

    {% if favs %}
      <div class="product-grid">
  {% for f in favs %}
    {% with product=f.product v=f.variant %}
    <div class="prod-card">
      <!-- FRONT -->
      <div class="card-front">
        <a href="{{ product.get_absolute_url|default:'#' }}">
          {% if v and v.image %}
            <img src="{{ v.image.url }}" alt="{{ product.name }}">
          {% elif product.image %}
            <img src="{{ product.image.url }}" alt="{{ product.name }}">
          {% else %}
            <img src="{% static 'zoosvit/img/food1.jpg' %}" alt="{{ product.name }}">
          {% endif %}
        </a>

        <div class="card-article">Артикул: {{ v.sku|default:product.sku|default:'—' }}</div>

        <h3 class="card-title" data-base-title="{{ product.name }}">
          {{ product.name }}{% if v %}
            {% if v.weight %} — {{ v.weight|floatformat:0 }} кг{% elif v.size %} — {{ v.size }}{% endif %}
          {% endif %}
        </h3>

        <div class="card-price">₴ {{ v.retail_price|default:product.retail_price }}</div>
      </div>

      <!-- BACK (без пігулок, лише обраний варіант) -->
      <div class="card-back">
        <a href="{{ product.get_absolute_url|default:'#' }}">
          {% if v and v.image %}
            <img src="{{ v.image.url }}" alt="{{ product.name }}">
          {% elif product.image %}
            <img src="{{ product.image.url }}" alt="{{ product.name }}">
          {% else %}
            <img src="{% static 'zoosvit/img/food1.jpg' %}" alt="{{ product.name }}">
          {% endif %}
          <div class="card-article">Артикул: {{ v.sku|default:product.sku|default:'—' }}</div>
          <h3 class="card-title" data-base-title="{{ product.name }}">
            {{ product.name }}{% if v %}
              {% if v.weight %} — {{ v.weight|floatformat:0 }} кг{% elif v.size %} — {{ v.size }}{% endif %}
            {% endif %}
          </h3>
        </a>

        <div class="card-price">₴ {{ v.retail_price|default:product.retail_price }}</div>

        <div class="card-actions">
          <a class="btn add-to-cart"
             href="{% url 'orders:add' product.id %}{% if v %}?variant={{ v.id }}{% endif %}">
            В кошик
          </a>
          <button class="btn-fav js-fav is-on"
                  data-url="{% url 'favourites:toggle' product.id %}"
                  data-variant="{% if v %}{{ v.id }}{% endif %}"
                  aria-pressed="true">❤️</button>
        </div>
        <div class="card-info">
          Виробник:
          {% if product.brand %}
            <a class="info-link" href="{% url 'products:brand' product.brand.brand_slug %}">{{ product.brand.name }}</a>
          {% else %} — {% endif %}
        </div>
<!--        <div class="card-info">-->
<!--          Країна:-->
<!--          {% if product.brand and product.brand.country_slug %}-->
<!--            <a class="info-link" href="{% url 'products:country' product.brand.country_slug %}">{{ product.brand.country }}</a>-->
<!--          {% else %} — {% endif %}-->
<!--        </div>-->
      </div>
    </div>
    {% endwith %}
  {% empty %}
    <div class="product-grid is-empty">
      <p class="no-favourites">У вас поки що немає обраних товарів. ;(</p>
    </div>
  {% endfor %}
</div>

    {% else %}
    <div class="product-grid is-empty">
      <p class="no-favourites">У вас поки що немає обраних товарів. ;(</p>
    </div>
    {% endif %}

{% if favs %}
{{ fav_variant_ids|json_script:"fav-variant-ids" }}

  <script>
    window.__favVarSet = new Set(JSON.parse(
      document.getElementById('fav-variant-ids').textContent || '[]'
    ));
  </script>
{% endif %}

  </section>
</div>
{% endblock %}