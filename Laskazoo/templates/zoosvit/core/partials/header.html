{% load static %}
{% include 'zoosvit/users/modal.html' with form=form %}
{% include 'zoosvit/orders/modal.html' %}
<script src="{% static 'zoosvit/js/login_modal.js' %}"></script>

<header class="site-header">
    <div class="site-topbar">
      <div class="container topbar-inner">
        <nav class="topbar-nav">
          <a href="{% url 'info_page' 'payment-delivery' %}">–û–ø–ª–∞—Ç–∞ —Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</a>
          <a href="{% url 'info_page' 'returns' %}">–û–±–º—ñ–Ω —Ç–∞ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è</a>
          <a href="{% url 'info_page' 'contacts' %}">–ö–æ–Ω—Ç–∞–∫—Ç–∏</a>
          <a href="{% url 'products:catalog' %}">–ö–∞—Ç–∞–ª–æ–≥</a>
        </nav>
      </div>
    </div>
    <div class="site-mainheader">
      <div class="container header-inner">
        <a class="logo" href="{% url 'home' %}">
          <img src="{% static 'zoosvit/img/laska_white3_.png' %}?v=4"
               alt="–õ–∞—Å–∫–∞" width="190" height="50" />
        </a>

        <!-- –ü–æ—à—É–∫ –∑ inline –ø—ñ–¥–∫–∞–∑–∫–∞–º–∏ -->
        <form id="main-search" class="search-form" method="get" action="{% url 'products:quick_search' %}">
          <input type="text" name="q" placeholder="–ü–æ—à—É–∫ —Ç–æ–≤–∞—Ä—ñ–≤" autocomplete="off" />
          <button type="submit" aria-label="–ü–æ—à—É–∫">üîç</button>

          <!-- Inline –ø—ñ–¥–∫–∞–∑–∫–∏ –ø—Ä—è–º–æ –ø—ñ–¥ –ø–æ–ª–µ–º -->
          <div class="search-dropdown" id="search-dropdown" hidden>
            <div class="search-results" id="search-results">
              <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–æ—à—É–∫—É -->
            </div>
          </div>
        </form>

        <div class="icon-btn phone-btn" id="phone-support-btn">
          <a href="{% url 'info_page' 'contacts' %}" class="phone-clickable-link">
            <img src="{% static 'zoosvit/img/header_icons/phone-icon.png' %}" alt="–¢–µ–ª–µ—Ñ–æ–Ω">
          </a>
          <div class="phone-dropdown">
            <div class="dropdown-title">–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è –º–µ–Ω–µ–¥–∂–µ—Ä—ñ–≤</div>
            <div class="dropdown-links">
              <a href="tel:+380932384730" class="dropdown-link">
                <img src="{% static 'zoosvit/img/header_icons/phone-icon.png' %}" alt="–¢–µ–ª–µ—Ñ–æ–Ω">
                <span>+38 093 238 47 30</span>
              </a>
              <a href="https://t.me/ds0903" class="dropdown-link" target="_blank">
                <img src="{% static 'zoosvit/img/header_icons/telagram-icon.png' %}" alt="Telegram">
                <span>Telegram</span>
              </a>
            </div>
            <hr style="margin: 8px 0; border: none; border-top: 1px solid #e0e0e0;">
            <div class="dropdown-schedule">
              <strong>–ì—Ä–∞—Ñ—ñ–∫ —Ä–æ–±–æ—Ç–∏:</strong> –ü–Ω‚Äì–ù–¥<br/>9:00 ‚Äì 20:00
            </div>
          </div>
        </div>

        <div class="header-actions">
          <!-- –Ü–∫–æ–Ω–∫–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ –¥—Ä–æ–ø–¥–∞—É–Ω–æ–º -->
          {% if user.is_authenticated %}
            <div class="icon-btn login-btn user-profile-btn" id="user-profile-btn">
              <img src="{% static 'zoosvit/img/header_icons/profile-icon.png' %}" alt="User">
              <div class="profile-dropdown">
                <div class="dropdown-title">{{ user.get_full_name|default:user.username }}</div>
                <div class="dropdown-links">
                  <a href="{% url 'users:profile' %}" class="dropdown-link">–ú—ñ–π –ø—Ä–æ—Ñ—ñ–ª—å</a>
                  <a href="{% url 'orders:list' %}" class="dropdown-link">–ú–æ—ó –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</a>
                  <a href="{% url 'favourites:list' %}" class="dropdown-link">–û–±—Ä–∞–Ω–µ</a>
                  <hr style="margin: 8px 0; border: none; border-top: 1px solid #e0e0e0;">
                  <a href="{% url 'users:logout' %}" class="dropdown-link">–í–∏–π—Ç–∏</a>
                </div>
              </div>
            </div>
          {% else %}
            <div class="icon-btn login-btn" id="user-login-btn">
              <img src="{% static 'zoosvit/img/header_icons/profile-icon.png' %}" alt="User">
              <div class="login-dropdown">
                <div class="dropdown-title">–í—Ö—ñ–¥ / –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</div>
                <div class="dropdown-chats">
                  <a href="#" class="dropdown-link" id="open-login-modal">–£–≤—ñ–π—Ç–∏</a>
                  <a href="#" class="dropdown-link" id="open-register-modal">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—å</a>
                </div>
              </div>
            </div>
          {% endif %}

          <!-- –û–±—Ä–∞–Ω–µ -->
          <a href="{% url 'favourites:list' %}" class="icon-btn header-icon" id="fav-btn" aria-label="–û–±—Ä–∞–Ω–µ">
            <img src="{% static 'zoosvit/img/header_icons/heart-icon.png' %}" alt="–û–±—Ä–∞–Ω–µ">
            <span id="fav-count" class="icon-badge js-fav-count" data-favs-count data-favs-live="server" {% if fav_count|default:0 <= 0 %}hidden{% endif %}>
              {{ fav_count|default:0 }}
            </span>
          </a>

          <!-- –ö–æ—à–∏–∫: –∑–∞–≤–∂–¥–∏ –∞–∫—Ç–∏–≤–Ω–∏–π –¥–ª—è –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª–∫–∏ -->
          <a href="#cart" class="btn-cart {% if cart_qty|default:0 <= 0 %}btn-cart--empty{% endif %}" aria-label="–ú—ñ–π –∫–æ—à–∏–∫" id="cart-btn">
            <img src="{% static 'zoosvit/img/header_icons/cart-icon.png' %}" alt="Cart">
            <span class="cart-count">{{ cart_qty|default:0 }}</span>
            <span class="cart-text">–ú—ñ–π –∫–æ—à–∏–∫</span>
          </a>

          <span class="cart-total" id="cart-total" {% if cart_total|floatformat:2 == "0.00" %}style="display: none;"{% endif %}>
            {% if cart_total|floatformat:2 != "0.00" %}
              {{ cart_total }} –≥—Ä–Ω
            {% endif %}
          </span>
        </div>
      </div>
    </div>
    <div class="site-bottombar">
      <div class="container topbar-inner">
        <nav class="topbar-nav">
          <a href="{% url 'products:subcategory_list' 'shares' %}">–ê–∫—Ü—ñ—ó</a>
          <a href="{% url 'products:subcategory_list' 'dogs' %}">–°–æ–±–∞–∫–∏</a>
          <a href="{% url 'products:subcategory_list' 'cats' %}">–ö–æ—Ç–∏</a>
{#          <a href="{% url 'products:subcategory_list' 'super-vigodniye-propozicii' %}">–°—É–ø–µ—Ä –≤–∏–≥—ñ–¥–Ω—ñ-–ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—ó</a>#}
        </nav>
      </div>
    </div>
</header>

<!-- JavaScript –¥–ª—è –≤—Å—ñ—î—ó —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—ñ -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  // =============== –ü–û–®–£–ö ===============
  const searchForm = document.getElementById('main-search');
  const searchInput = searchForm?.querySelector('input[name="q"]');
  const searchDropdown = document.getElementById('search-dropdown');
  const searchResults = document.getElementById('search-results');
  const API_URL = "{% url 'products:search_suggest' %}";

  let searchItems = [];
  let activeIndex = -1;

  // Debounce function
  const debounce = (fn, delay = 200) => {
    let timeoutId;
    return (...args) => {
      clearTimeout(timeoutId);
      timeoutId = setTimeout(() => fn(...args), delay);
    };
  };

  // Escape HTML
  const escapeHtml = (text) => {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  };

  // –ü–æ–∑–∏—Ü—ñ–æ–Ω—É—î–º–æ dropdown –ø—ñ–¥ –ø–æ–ª–µ–º –ø–æ—à—É–∫—É
  function positionSearchDropdown() {
    if (!searchForm || !searchDropdown) return;

    const rect = searchForm.getBoundingClientRect();
    const isMobile = window.innerWidth <= 768;
    
    searchDropdown.style.position = 'fixed';
    searchDropdown.style.top = (rect.bottom + 2) + 'px';
    searchDropdown.style.left = rect.left + 'px';
    
    // –ù–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö - –ø—Ä–∏—Å—Ç–æ—Å–æ–≤—É—î–º–æ—Å—è –¥–æ —Ä–æ–∑–º—ñ—Ä—É –ø–æ–ª—è, –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø—ñ - —Ä–æ–∑—à–∏—Ä—é—î–º–æ
    if (isMobile) {
      searchDropdown.style.width = Math.max(rect.width, 320) + 'px';
    } else {
      searchDropdown.style.width = Math.max(rect.width, 600) + 'px';
    }
    
    searchDropdown.style.zIndex = '9999';
  }

  // –ü–æ–∫–∞–∑—É—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–æ—à—É–∫—É –∑ –ø–æ–≤–Ω–æ—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é —É —Ä–æ–∑—à–∏—Ä–µ–Ω–æ–º—É –≤—ñ–∫–Ω—ñ
  function showSearchResults(items) {
    if (!searchResults) return;

    if (!items.length) {
      searchResults.innerHTML = '<div class="search-no-results">–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</div>';
    } else {
      const html = items.map((item, index) => `
        <div class="search-item" data-index="${index}" data-url="${escapeHtml(item.url || '')}">
          <img src="${escapeHtml(item.image || '')}" alt="" class="search-item-image">
          <div class="search-item-content">
            <div class="search-item-title">${escapeHtml(item.name || '')}</div>
            ${item.brand ? `<div class="search-item-brand">–í–∏—Ä–æ–±–Ω–∏–∫: ${escapeHtml(item.brand)}</div>` : ''}
            ${item.weight ? `<div class="search-item-brand">–í–∞–≥–∞: ${escapeHtml(item.weight)} –∫–≥</div>` : ''}
            ${item.sku ? `<div class="search-item-brand">–ê—Ä—Ç–∏–∫—É–ª: ${escapeHtml(item.sku)}</div>` : ''}
          </div>
          <div class="search-item-price">${item.price ? '‚Ç¥ ' + Number(item.price).toFixed(0) : ''}</div>
        </div>
      `).join('');
      searchResults.innerHTML = html;
    }

    searchDropdown.hidden = false;
    positionSearchDropdown();
    activeIndex = -1;
  }

  // –•–æ–≤–∞—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–æ—à—É–∫—É
  function hideSearchResults() {
    if (searchDropdown) {
      searchDropdown.hidden = true;
    }
    activeIndex = -1;
  }

  // –í–∏–∫–æ–Ω—É—î–º–æ –ø–æ—à—É–∫
  const performSearch = debounce(async (query) => {
    if (query.length < 2) {
      hideSearchResults();
      return;
    }

    try {
      const response = await fetch(`${API_URL}?q=${encodeURIComponent(query)}`);
      const data = await response.json();
      searchItems = data.items || [];
      showSearchResults(searchItems);
    } catch (error) {
      console.error('Search error:', error);
      hideSearchResults();
    }
  }, 180);

  // –ü–æ–¥—ñ—ó –ø–æ—à—É–∫—É
  if (searchInput) {
    searchInput.addEventListener('input', (e) => {
      performSearch(e.target.value.trim());
    });

    searchInput.addEventListener('focus', () => {
      const query = searchInput.value.trim();
      if (query.length >= 2 && searchItems.length > 0) {
        showSearchResults(searchItems);
      }
    });
  }

  // –ù–∞–≤—ñ–≥–∞—Ü—ñ—è –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–æ—é
  document.addEventListener('keydown', (e) => {
    if (searchDropdown?.hidden !== false) return;

    const items = searchResults?.querySelectorAll('.search-item') || [];

    if (e.key === 'ArrowDown') {
      e.preventDefault();
      activeIndex = Math.min(activeIndex + 1, items.length - 1);
      updateActiveItem(items);
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      activeIndex = Math.max(activeIndex - 1, -1);
      updateActiveItem(items);
    } else if (e.key === 'Enter') {
      e.preventDefault();
      if (activeIndex >= 0 && searchItems[activeIndex]?.url) {
        window.location.href = searchItems[activeIndex].url;
      } else {
        searchForm?.submit();
      }
    } else if (e.key === 'Escape') {
      hideSearchResults();
    }
  });

  function updateActiveItem(items) {
    items.forEach((item, index) => {
      item.classList.toggle('active', index === activeIndex);
    });
  }

  // –ö–ª—ñ–∫ –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –ø–æ—à—É–∫—É
  if (searchResults) {
    searchResults.addEventListener('click', (e) => {
      const item = e.target.closest('.search-item');
      if (item?.dataset.url) {
        window.location.href = item.dataset.url;
      }
    });
  }

  // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –ø—Ä–∏ –∫–ª—ñ–∫—É –ø–æ–∑–∞ —Ñ–æ—Ä–º–æ—é
  document.addEventListener('click', (e) => {
    if (!searchForm?.contains(e.target)) {
      hideSearchResults();
    }
  });

  // –ü–æ–∑–∏—Ü—ñ–æ–Ω—É—î–º–æ –ø—Ä–∏ —Å–∫—Ä–æ–ª—ñ/—Ä–µ—Å–∞–π–∑—ñ
  window.addEventListener('scroll', positionSearchDropdown);
  window.addEventListener('resize', positionSearchDropdown);

  // =============== –ü–û–ö–†–ê–©–ï–ù–ò–ô –¢–ï–õ–ï–§–û–ù–ù–ò–ô –î–†–û–ü–î–ê–£–ù ===============
  const phoneBtn = document.getElementById('phone-support-btn');
  const phoneDropdown = phoneBtn?.querySelector('.phone-dropdown');
  const phoneLink = phoneBtn?.querySelector('.phone-clickable-link');

  if (phoneBtn && phoneDropdown && phoneLink) {
    let phoneTimer;

    const showPhoneDropdown = () => {
      clearTimeout(phoneTimer);
      phoneDropdown.classList.add('show');
    };

    const hidePhoneDropdown = () => {
      phoneTimer = setTimeout(() => {
        phoneDropdown.classList.remove('show');
      }, 150);
    };

    // Hover events –¥–ª—è –ø–æ–∫–∞–∑—É –¥—Ä–æ–ø–¥–∞—É–Ω—É
    phoneBtn.addEventListener('mouseenter', showPhoneDropdown);
    phoneBtn.addEventListener('mouseleave', hidePhoneDropdown);
    phoneDropdown.addEventListener('mouseenter', showPhoneDropdown);
    phoneDropdown.addEventListener('mouseleave', hidePhoneDropdown);
    
    // –ö–ª—ñ–∫ –ø–æ –ª—ñ–Ω–∫—É –≤–µ–¥–µ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤ (–±—Ä–∞—É–∑–µ—Ä —Å–∞–º –æ–±—Ä–æ–±–ª—è—î —Ü–µ)
    // –ù–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞–≤–∞—Ç–∏ preventDefault, —â–æ–± –ª—ñ–Ω–∫ –ø—Ä–∞—Ü—é–≤–∞–≤
  }

  // =============== –î–†–û–ü–î–ê–£–ù–ò –ö–û–†–ò–°–¢–£–í–ê–ß–ê ===============
  // –î–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ - hover
  const userProfileBtn = document.getElementById('user-profile-btn');
  const profileDropdown = userProfileBtn?.querySelector('.profile-dropdown');

  if (userProfileBtn && profileDropdown) {
    let profileTimer;

    const showProfileDropdown = () => {
      clearTimeout(profileTimer);
      profileDropdown.classList.add('show');
    };

    const hideProfileDropdown = () => {
      profileTimer = setTimeout(() => {
        profileDropdown.classList.remove('show');
      }, 150);
    };

    userProfileBtn.addEventListener('mouseenter', showProfileDropdown);
    userProfileBtn.addEventListener('mouseleave', hideProfileDropdown);
    profileDropdown.addEventListener('mouseenter', showProfileDropdown);
    profileDropdown.addEventListener('mouseleave', hideProfileDropdown);

    // –¢–∞–∫–æ–∂ –∫–ª—ñ–∫ –≤—ñ–¥–∫—Ä–∏–≤–∞—î –ø—Ä–æ—Ñ—ñ–ª—å
    userProfileBtn.addEventListener('click', (e) => {
      const firstLink = profileDropdown.querySelector('.dropdown-link');
      if (firstLink) {
        window.location.href = firstLink.href;
      }
    });
  }

  // –î–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏—Ö - hover (—è–∫ —É –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏—Ö)
  const userLoginBtn = document.getElementById('user-login-btn');
  const loginDropdown = userLoginBtn?.querySelector('.login-dropdown');

  if (userLoginBtn && loginDropdown) {
    let loginTimer;

    const showLoginDropdown = () => {
      clearTimeout(loginTimer);
      loginDropdown.classList.add('show');
    };

    const hideLoginDropdown = () => {
      loginTimer = setTimeout(() => {
        loginDropdown.classList.remove('show');
      }, 150);
    };

    userLoginBtn.addEventListener('mouseenter', showLoginDropdown);
    userLoginBtn.addEventListener('mouseleave', hideLoginDropdown);
    loginDropdown.addEventListener('mouseenter', showLoginDropdown);
    loginDropdown.addEventListener('mouseleave', hideLoginDropdown);

    // –¢–∞–∫–æ–∂ –∑–∞–ª–∏—à–∞—î–º–æ –∫–ª—ñ–∫ –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤
    userLoginBtn.addEventListener('click', (e) => {
      e.preventDefault();
      loginDropdown.classList.toggle('show');
    });

    // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –ø—Ä–∏ –∫–ª—ñ–∫—É –ø–æ–∑–∞ –¥—Ä–æ–ø–¥–∞—É–Ω–æ–º
    document.addEventListener('click', (e) => {
      if (!userLoginBtn.contains(e.target)) {
        loginDropdown.classList.remove('show');
      }
    });
  }

  // =============== –û–ë–†–ê–ù–ï –ë–ï–ô–î–ñ ===============
  async function updateFavouritesBadge() {
    try {
      const response = await fetch('{% url "favourites:api_count" %}');
      const data = await response.json();
      const badge = document.getElementById('fav-count');

      if (badge) {
        badge.textContent = data.count || 0;
        badge.hidden = (data.count || 0) <= 0;
      }
    } catch (error) {
      console.error('Error updating favourites badge:', error);
    }
  }

  updateFavouritesBadge();
});
</script>

<!-- –°—Ç–∏–ª—ñ –¥–ª—è –ø–æ—à—É–∫—É —ñ –¥—Ä–æ–ø–¥–∞—É–Ω—ñ–≤ -->
<style>
/* –ü–æ—à—É–∫–æ–≤—ñ –ø—ñ–¥–∫–∞–∑–∫–∏ */
.search-form {
  position: relative;
}

.search-dropdown {
  position: fixed;
  background: #fff;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  max-height: 400px;
  overflow-y: auto;
  z-index: 9999;
  /* –®–∏—Ä–∏–Ω–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ —á–µ—Ä–µ–∑ JavaScript */
  min-width: 600px;
}

.search-results {
  padding: 8px 0;
}

.search-item {
  display: flex;
  align-items: center;
  padding: 12px 16px;
  cursor: pointer;
  transition: background-color 0.2s, box-shadow 0.2s;
  gap: 16px;
  border-bottom: 1px solid #f0f0f0;
}

.search-item:hover,
.search-item.active {
  background-color: #f8f9fa;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  border-radius: 6px;
}

.search-item:last-child {
  border-bottom: none;
}

.search-item-image {
  width: 60px;
  height: 60px;
  object-fit: contain;
  border-radius: 8px;
  background: #f8f8f8;
  border: 1px solid #e8e8e8;
  flex-shrink: 0;
}

.search-item-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 4px;
  min-width: 0;
}

.search-item-title {
  font-weight: 600;
  color: #333;
  font-size: 0.95rem;
  line-height: 1.4;
  margin-bottom: 4px;
}

.search-item-brand {
  font-size: 0.8rem;
  color: #666;
  font-weight: 400;
}

.search-item-price {
  color: var(--color-primary);
  font-weight: 700;
  font-size: 1.1rem;
  margin-left: auto;
  flex-shrink: 0;
}

.search-no-results {
  padding: 16px;
  text-align: center;
  color: #666;
  font-size: 0.9rem;
}

/* –î—Ä–æ–ø–¥–∞—É–Ω –ø—Ä–æ—Ñ—ñ–ª—é –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏—Ö */
.user-profile-btn {
  position: relative;
}

.profile-dropdown {
  opacity: 0;
  visibility: hidden;
  transition:
    opacity 0.35s ease-in-out,
    transform 0.35s ease-in-out,
    visibility 0.35s;
  position: absolute;
  top: calc(100% + 8px);
  left: 50%;
  transform: translateX(-50%) translateY(10px);
  width: 220px;
  background: #fff;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  padding: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  z-index: 999;
  font-size: 0.875rem;
  color: #333;
}

.profile-dropdown.show {
  opacity: 1;
  visibility: visible;
  transform: translateX(-50%) translateY(0);
}

.profile-dropdown .dropdown-title {
  font-weight: 600;
  margin-bottom: 8px;
  color: var(--color-primary);
  padding-bottom: 8px;
  border-bottom: 1px solid #e0e0e0;
}

.profile-dropdown .dropdown-links {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.profile-dropdown .dropdown-link {
  color: #333;
  text-decoration: none;
  padding: 6px 8px;
  border-radius: 4px;
  transition: background 0.2s;
}

.profile-dropdown .dropdown-link:hover {
  background: rgba(9,94,86,0.1);
  color: var(--color-primary);
}

/* –ù–µ–∞–∫—Ç–∏–≤–Ω–∏–π –∫–æ—à–∏–∫ */
.btn-cart--disabled {
  opacity: 0.5;
  cursor: not-allowed;
  pointer-events: none;
}

.btn-cart--disabled:hover {
  background: #fff !important;
  transform: none !important;
}

.btn-cart--disabled img {
  filter: none !important;
}

/* –°—Ç–∏–ª—ñ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Ç–µ–ª–µ—Ñ–æ–Ω—É –∑ –∫–ª—ñ–∫–æ–º */
.phone-clickable-link {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  color: inherit;
  text-decoration: none;
  border-radius: 50%;
  transition: background 0.2s;
}

.phone-clickable-link:hover {
  background: rgba(9, 94, 86, 0.1);
}

.phone-btn {
  position: relative;
}

/* –ú–æ–±—ñ–ª—å–Ω–∞ –∞–¥–∞–ø—Ç–∞—Ü—ñ—è –¥–ª—è —Ä–æ–∑—à–∏—Ä–µ–Ω–æ–≥–æ –ø–æ—à—É–∫—É */
@media (max-width: 768px) {
  .search-dropdown {
    max-height: 300px;
    min-width: 320px; /* –ú–µ–Ω—à–∏–π –º—ñ–Ω—ñ–º—É–º –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö */
  }

  .search-item {
    padding: 10px 12px;
    gap: 12px;
  }

  .search-item-image {
    width: 50px;
    height: 50px;
  }

  .search-item-title {
    font-size: 0.9rem;
  }
  
  .search-item-brand {
    font-size: 0.75rem;
  }
  
  .search-item-price {
    font-size: 1rem;
  }
}
</style>

<!-- –ü—ñ–¥—Ç—è–≥—É—î–º–æ –¥–∞–Ω—ñ –¥–ª—è –æ–±—Ä–∞–Ω–æ–≥–æ -->
{{ fav_variant_ids|json_script:"fav-variant-ids" }}
{{ fav_product_ids|json_script:"fav-product-ids" }}
<script>
(function(){
  try {
    const v = JSON.parse(document.getElementById('fav-variant-ids')?.textContent || '[]').map(Number);
    const p = JSON.parse(document.getElementById('fav-product-ids')?.textContent || '[]').map(Number);
    window.__favVarSet = new Set(v);
    window.__favProdSet = new Set(p);
  } catch(e) {
    window.__favVarSet = window.__favVarSet || new Set();
    window.__favProdSet = window.__favProdSet || new Set();
  }
})();
</script>
