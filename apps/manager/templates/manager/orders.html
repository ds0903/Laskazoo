{% extends 'manager/base.html' %}

{% block manager_content %}
<div class="manager-header">
  <h1>üì¶ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</h1>
  <div style="display: flex; gap: 10px;">
    <form method="get" style="display: flex; gap: 10px;">
      <select name="status" style="padding: 10px 15px; border: 1px solid #ddd; border-radius: 6px;">
        <option value="">–í—Å—ñ —Å—Ç–∞—Ç—É—Å–∏</option>
        {% for value, label in status_choices %}
          <option value="{{ value }}" {% if status_filter == value %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
      <input type="text" name="search" value="{{ search_query }}" 
             placeholder="–ü–æ—à—É–∫ –∑–∞–º–æ–≤–ª–µ–Ω—å..." 
             style="padding: 10px 15px; border: 1px solid #ddd; border-radius: 6px; width: 250px;">
      <button type="submit" 
              style="padding: 10px 20px; background: var(--color-primary); color: white; border: none; border-radius: 6px; cursor: pointer;">
        üîç –®—É–∫–∞—Ç–∏
      </button>
      {% if status_filter or search_query %}
      <a href="{% url 'manager:orders' %}" 
         style="padding: 10px 20px; background: #6c757d; color: white; text-decoration: none; border-radius: 6px; display: inline-block;">
        –°–∫–∏–Ω—É—Ç–∏
      </a>
      {% endif %}
    </form>
  </div>
</div>

<div style="overflow-x: auto;">
  <table style="width: 100%; border-collapse: collapse;">
    <thead>
      <tr style="background: #f8f9fa;">
        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6;">‚Ññ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</th>
        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6;">–ö–ª—ñ—î–Ω—Ç</th>
        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6;">–¢–µ–ª–µ—Ñ–æ–Ω</th>
        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6;">Email</th>
        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6;">–î–∞—Ç–∞</th>
        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6;">–°—É–º–∞</th>
        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6;">–°—Ç–∞—Ç—É—Å</th>
        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6;">–î—ñ—ó</th>
      </tr>
    </thead>
    <tbody>
      {% for order in page_obj %}
      <tr style="border-bottom: 1px solid #dee2e6;">
        <td style="padding: 12px; font-weight: 600;">{{ order.order_number|default:order.id }}</td>
        <td style="padding: 12px;">{{ order.full_name|default:order.user.get_full_name|default:order.user.username }}</td>
        <td style="padding: 12px;">{{ order.phone|default:"‚Äî" }}</td>
        <td style="padding: 12px;">{{ order.email|default:order.user.email }}</td>
        <td style="padding: 12px;">{{ order.created_at|date:"d.m.Y H:i" }}</td>
        <td style="padding: 12px; font-weight: 600;">{{ order.total_amount }} –≥—Ä–Ω</td>
        <td style="padding: 12px;">
          {% if order.status == 'new' %}
            <span style="background: #ffc107; color: #000; padding: 4px 8px; border-radius: 4px; font-size: 0.85rem;">{{ order.get_status_display }}</span>
          {% elif order.status == 'in_process' or order.status == 'processing' %}
            <span style="background: #17a2b8; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.85rem;">{{ order.get_status_display }}</span>
          {% elif order.status == 'completed' %}
            <span style="background: #28a745; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.85rem;">{{ order.get_status_display }}</span>
          {% elif order.status == 'canceled' %}
            <span style="background: #dc3545; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.85rem;">{{ order.get_status_display }}</span>
          {% else %}
            <span style="background: #6c757d; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.85rem;">{{ order.get_status_display }}</span>
          {% endif %}
        </td>
        <td style="padding: 12px;">
          <a href="{% url 'manager:order_detail' order.id %}" 
             style="padding: 6px 12px; background: var(--color-primary); color: white; text-decoration: none; border-radius: 4px; font-size: 0.85rem;">
            –î–µ—Ç–∞–ª—å–Ω—ñ—à–µ
          </a>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="8" style="padding: 30px; text-align: center; color: #6c757d;">
          –ó–∞–º–æ–≤–ª–µ–Ω—å –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% if page_obj.has_other_pages %}
<div style="margin-top: 30px; display: flex; justify-content: center; gap: 10px;">
  {% if page_obj.has_previous %}
    <a href="?page=1{% if status_filter %}&status={{ status_filter }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}" 
       style="padding: 8px 12px; background: #f8f9fa; color: #333; text-decoration: none; border-radius: 4px;">–ü–µ—Ä—à–∞</a>
    <a href="?page={{ page_obj.previous_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}" 
       style="padding: 8px 12px; background: #f8f9fa; color: #333; text-decoration: none; border-radius: 4px;">‚Üê –ù–∞–∑–∞–¥</a>
  {% endif %}
  
  <span style="padding: 8px 12px; background: var(--color-primary); color: white; border-radius: 4px;">
    –°—Ç–æ—Ä—ñ–Ω–∫–∞ {{ page_obj.number }} –∑ {{ page_obj.paginator.num_pages }}
  </span>
  
  {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}" 
       style="padding: 8px 12px; background: #f8f9fa; color: #333; text-decoration: none; border-radius: 4px;">–í–ø–µ—Ä–µ–¥ ‚Üí</a>
    <a href="?page={{ page_obj.paginator.num_pages }}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}" 
       style="padding: 8px 12px; background: #f8f9fa; color: #333; text-decoration: none; border-radius: 4px;">–û—Å—Ç–∞–Ω–Ω—è</a>
  {% endif %}
</div>
{% endif %}
{% endblock %}
